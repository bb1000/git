<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

    <style type="text/css">
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif);
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body {
        font-family: 'Droid Serif';
      }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: 400;
        margin-bottom: 0;
      }
      .remark-slide-content h1 { font-size: 3em; }
      .remark-slide-content h2 { font-size: 2em; }
      .remark-slide-content h3 { font-size: 1.6em; }
      .footnote {
        position: absolute;
        bottom: 3em;
      }
      li p { line-height: 1.25em; }
      .red { color: #fa0000; }
      .large { font-size: 2em; }
      a, a > code {
        color: rgb(249, 38, 114);
        text-decoration: none;
      }
      code {
        -moz-border-radius: 5px;
        -web-border-radius: 5px;
        background: #e7e8e2;
        border-radius: 5px;
      }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }
      .remark-code-line-highlighted     { background-color: #373832; }
      .pull-left {
        float: left;
        width: 47%;
      }
      .pull-right {
        float: right;
        width: 47%;
      }
      .pull-right ~ p {
        clear: both;
      }
      #slideshow .slide .content code {
        font-size: 0.8em;
      }
      #slideshow .slide .content pre code {
        font-size: 0.9em;
        padding: 15px;
      }
      .inverse {
        background: #272822;
        color: #777872;
        text-shadow: 0 0 20px #333;
      }
      .inverse h1, .inverse h2 {
        color: #f3f3f3;
        line-height: 0.8em;
      }

      /* Slide-specific styling */
      #slide-inverse .footnote {
        bottom: 12px;
        left: 20px;
      }
      #slide-how .slides {
        font-size: 0.9em;
        position: absolute;
        top:  151px;
        right: 140px;
      }
      #slide-how .slides h3 {
        margin-top: 0.2em;
      }
      #slide-how .slides .first, #slide-how .slides .second {
        padding: 1px 20px;
        height: 90px;
        width: 120px;
        -moz-box-shadow: 0 0 10px #777;
        -webkit-box-shadow: 0 0 10px #777;
        box-shadow: 0 0 10px #777;
      }
      #slide-how .slides .first {
        background: #fff;
        position: absolute;
        top: 20%;
        left: 20%;
        z-index: 1;
      }
      #slide-how .slides .second {
        position: relative;
        background: #fff;
        z-index: 0;
      }

      /* Two-column layout */
      .left-column {
        color: #777;
        width: 20%;
        height: 92%;
        float: left;
      }
        .left-column h2:last-of-type, .left-column h3:last-child {
          color: #000;
        }
      .right-column {
        width: 75%;
        float: right;
        padding-top: 1em;
      }
    </style>
    <script type="text/javascript"
      src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>

  </head>
  <body>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
    <script src="/git/refreeze/js/springy.js"></script>
    <script src="/git/refreeze/js/springyui.js"></script>
    <script>
        
    </script>
    <textarea id="source">
name: inverse
layout: true
class: center, middle, inverse

---

&lt;script type=&#34;text/javascript&#34;
  src=&#34;https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML&#34;&gt;
&lt;/script&gt;
&lt;style&gt;
pre.code {
    color: #ffffff;
    background: #000000;
    border-radius: 5px;
    font-size: 0.8em;
    padding: 15px;
}
span.red {
   color: red;
}
span.green {
   color: lightgreen;
}
span.cyan {
   color: cyan;
}
span.commit {
   color: orange;
}
&lt;/style&gt;
# Introduction to git

BB1000 Programming in Python
KTH

---

layout: false

## Learning objectives

* What version control is

* Why we should use version control

* Why we choose use git

* Know about the basic components in git
    - work directory
    - staging area
    - repository (local, remote)
    - branches

* Know commands for basic git workflow
    - How to save history
    - How to undo mistakes
    - How to collaborate with others (github)

---

## What is version control:

* A Version Control System (VCS) is a frameorks that tracks the history of a project

* The history of a project is a sequence of versions

* At any point in time we can go back to a previous version

* A VCS allows you to compare different versions

* A VCS allows several users to work on the same project files simultaneously

---

## Why use version control

You may already have used some manual version...

```
$ cp -r Project Project.save
```

... some work ...

```
$ cp -r Project Project.save.v2
```

... some work ...

```
$ cp -r Project Project.save.v2.new
```

---

&lt;center&gt;
&lt;img src=&#34;http://www.phdcomics.com/comics/archive/phd101212s.gif&#34; height=&#34;500&#34;/&gt;
&lt;/center&gt;

---

## Introducing git

&lt;center&gt;
&lt;img src=&#34;http://www.linux.com/images/stories/714/Linus-Torvalds-LinuxCon-Europe-2014.jpg&#34; height=&#34;250&#34; /&gt;
&lt;/center&gt;


* Written by Linus Thorvalds, originally for the Linux kernel
* A distributed Version Control System
* Several servers have all information
* Any one can be chosen as the reference version
* One of the most popular frameworks today (others: bazaar, mercurial)

* Historical frameworks (subversion, CVS, RCS)

---

## When to use

### Scenario

* For source code development
* For manuscripts
* In single-user projects
* In collaborative projects

### Benefits

* No history is lost
* All versions of your documents are preserved
* Easy to backup to other sites

---

## Concepts

* Work directory: local directory where you work
* Cache: temporary area for files you intend to keep
* Commit: a snapshot of the project files at a point in time
* Repository: sequence/tree of commits (history of the project)

---

## Concepts

* Work directory: local directory where you work
* Cache: temporary area for files you intend to keep
* Commit: a snapshot of the project files at a point in time
* Repository: sequence/tree of commits (history of the project)

### 11 basic commands

* Initialize
   - clone
   - init
* Queries
   - status
   - log
   - diff
* Changing locally
   - add
   - commit
   - merge
* Remote interaction
   - push
   - fetch
   - pull

---

## Setup

### The first time around

```
    $ git config --global user.name &#34;First Last&#34;
    $ git config --global user.email &#34;first.last@isp.com&#34;
```

Creates a configuration file ``~/.gitconfig``

```
    [user]
	name = First Last
	email = first.last@isp.com
```

*Note*:    You can create and edit the file directly

---

## Initializing a repository

* Use an existing directory or create a new project directory

```
    $ mkdir proj
```

&lt;pre class=&#39;foo&#39;&gt;
    proj/
&lt;/pre&gt;

* Go to the directory and initialize

```
    $ cd proj
    $ git init
    Initialized empty Git repository in (...)proj/.git/
```

&lt;pre&gt;
    proj/
    └── .git
&lt;/pre&gt;

---
## Check status

&lt;pre&gt;
proj/
└── .git
&lt;/pre&gt;


* Check repository status

```
$ git status
On branch master

No commits yet

nothing to commit (create/copy files and use &#34;git add&#34; to track)
```

---
## Create a new file `hello.py`

&lt;pre&gt;
proj
├── .git
└── &lt;text style=&#34;color: red;&#34;&gt;hello.py&lt;/text&gt;
&lt;/pre&gt;


```
#hello.py
print(&#34;Hello world!&#34;)
```

* Recheck status

&lt;pre style=&#34;color: #ffffff; background: #000000; border-radius: 5px; font-size: 0.8em; padding: 15px&#34;&gt;
$ git status
On branch master

No commits yet

Untracked files:
  (use &#34;git add &lt;file&gt;...&#34; to include in what will be committed)

   &lt;text style=&#34;color: red;&#34;&gt;hello.py&lt;/text&gt;

nothing added to commit but untracked files present (use &#34;git add&#34; to track)
&lt;/pre&gt;

* Git warns about *untracked* files (files that Git does not know anything
  about)

---
## Add file to Git

&lt;pre&gt;
proj
├── .git
└── &lt;span style=&#34;color: green;&#34;&gt;hello.py&lt;/span&gt;
&lt;/pre&gt;


&lt;pre class=&#34;code&#34;&gt;
$ git add hello.py

$ git status
On branch master

No commits yet

Changes to be committed:
  (use &#34;git rm --cached &lt;file&gt;...&#34; to unstage)

    &lt;text style=&#34;color: lightgreen;&#34;&gt; new file:   hello.py&lt;/text&gt;
&lt;/pre&gt;

### The staging area/cache

* After `git add` a file is in the staging area (cache), is staged to be
  committed to the repository
* This is an intermediate level between the work directory and repository

---
## Save to repository

&lt;pre&gt;
proj
├── .git
└── hello.py
&lt;/pre&gt;


* Save the latest changes in the local repository (in `.git` directory)

```
    $ git commit -m &#34;First hello&#34;
    [master (root-commit) cf06b48] First hello
     1 file changed, 1 insertion(+)
     create mode 100644 hello.py
```

* Check the status again

```
    $ git status
    On branch master
    nothing to commit, working directory clean
```

---

## The work cycle

There are three levels

* The work directory
* The staging area
* The repository

```
repository (.git)
    ^
    |   commit

staging area (cache)
    ^
    |   add

work directory     &lt;- init
```

---

## The work cycle

There are three levels

* The work directory
* The staging area
* The repository

```
repository (.git)
    ^
    |   commit

staging area (cache)
    ^
    |   add

work directory     &lt;- init
```

The basic work cycle is edit-add-commit

```
    $ &lt;edit&gt; &lt;file&gt;   # edit your file
    $ git add &lt;file&gt;  # cache your changes
    $ git commit -m &lt;message&gt; &lt;file&gt;  # save your changes in repository
```

---

## A mental model of the .git folder

After committing two versions of a project file
we can imagine a folder tree like this (not real)

&lt;pre&gt;
proj
├── .git
│   ├── cache
│   │   └── hello.py
│   └── repository
│       └── commit1
│           └── hello.py
│       └── commit2
│           └── hello.py
└── hello.py
&lt;/pre&gt;

* A `git add` copies from the work directory `proj/hello.py` to the cache
  `/proj.git/cache/hello.py`
* A `git commit` creates a new entry in the repository and copies from the
  cache to a new folder, e.g. `proj/.git/repository/commit2/hello.py`
* All old versions are preserved

---

## Review history

To see the commit history of the project files

&lt;pre class=&#34;code&#34;&gt;
$ git log --oneline
&lt;span class=&#34;commit&#34;&gt;f56e3da&lt;/span&gt; (&lt;span class=&#34;cyan&#34;&gt;HEAD&lt;/span&gt; -&gt; &lt;span class=&#34;green&#34;&gt;master&lt;/span&gt;) First hello
&lt;/pre&gt;

&lt;center&gt;
&lt;img src=&#34;gitink/c1.svg&#34;&gt;
&lt;/center&gt;

* A branch is viewed as a line of a development
* Initial default branch is always `master`
* A branch in practise a label for a particular commit
* HEAD is an alias for the current active branch

---

## Viewing changes

* Consider a modified file

&lt;pre class=&#34;code&#34;&gt;
#hello.py
print(&#34;Hello there world!&#34;)
&lt;/pre&gt;

* git now recognizes this tracked file as modified

&lt;pre class=&#34;code&#34;&gt;
$ git status
On branch master
Changes not staged for commit:
  (use &#34;git add &lt;file&gt;...&#34; to update what will be committed)
  (use &#34;git checkout -- &lt;file&gt;...&#34; to discard changes in working directory)

        &lt;span class=&#34;red&#34;&gt;modified:   hello.py&lt;/span&gt;

no changes added to commit (use &#34;git add&#34; and/or &#34;git commit -a&#34;)
&lt;/pre&gt;

---

## Viewing changes

&lt;pre class=&#34;code&#34;&gt;
$ git diff
diff --git a/hello.py b/hello.py
index ed708ec..01c97be 100644
--- a/hello.py
+++ b/hello.py
&lt;span class=&#34;cyan&#34; &gt;@@ -1 +1 @@&lt;/span&gt;
&lt;span class=&#34;red&#34;  &gt;-print(&#34;Hello world!&#34;)&lt;/span&gt;
&lt;span class=&#34;green&#34;&gt;+print(&#34;Hello there world!&#34;)&lt;/span&gt;
&lt;/pre&gt;

---

## Save changes

* First to cache

```bash
$ git add hello.py
$ git status
On branch master
Changes to be committed:
  (use &#34;git reset HEAD &lt;file&gt;...&#34; to unstage)

	modified:   hello.py
```

* then to repository

```bash
$ git commit -m &#34;Change greeting&#34;
[master f7efe62] Change greeting
 1 file changed, 1 insertion(+), 1 deletion(-)
```
---

## History after commits

```bash
$ git log --oneline
b895711 (HEAD -&gt; master) Change greeting
f56e3da First hello
```

&lt;center&gt;&lt;img src=&#34;gitink/c2.svg&#34;&gt;&lt;/center&gt;

---

## Recovering old work

* To retreive old verions, use checkout with the commit string

```
$ git checkout f56e3da
Note: checking out &#39;f56e3da&#39;.

You are in &#39;detached HEAD&#39; state. You can look around, make experimental
changes and commit them, and you can discard any commits you make in this
state without impacting any branches by performing another checkout.

If you want to create a new branch to retain commits you create, you may
do so (now or later) by using -b with the checkout command again. Example:

  git checkout -b &lt;new-branch-name&gt;

HEAD is now at f56e3da... First hello
```

```
$ cat hello.py
print(&#34;Hello world&#34;)!
```

---

```
$ git log --oneline --all
b895711 (master) Change greeting
f56e3da (HEAD) First hello
```

&lt;img src=&#34;gitink/c3.svg&#34;&gt;

```
$git checkout master
Previous HEAD position was f56e3da... First hello
Switched to branch &#39;master&#39;
```

&lt;img src=&#34;gitink/c4.svg&#34;&gt;

---

## The work cycle

There are three levels:

* The work directory
* The staging area
* The repository

```
repository (c1 -&gt; c2 -&gt; c3...)
    ^
    |   commit #save permanently in repository

staging area (cache)

    ^
    |   add  #adds new file or saves latest changes

work directory
```

---

## Branches

```
$ git branch in-more-languages
$ git checkout in-more-languages 
Switched to branch &#39;in-more-languages&#39;
```
```
$ git log --oneline --all
b895711 (HEAD -&gt; in-more-languages, master) Change greeting
f56e3da First hello
```
&lt;img src=&#34;gitink/c5.svg&#34;&gt;

---

## Work in the new branch

```python
#hello.py
print(&#34;Hello there world!&#34;)
print(&#34;Bonjour tout le monde!&#34;)
```

```
$ git add -u 
$ git commit -m &#34;French&#34;
[in-more-languages 84bfae8] French
 1 file changed, 1 insertion(+)
```

```
$ git log --oneline
84bfae8 (HEAD -&gt; in-more-languages) French
b895711 (master) Change greeting
f56e3da First hello
```
---

## Work in the new branch

```
$ git log --oneline
84bfae8 (HEAD -&gt; in-more-languages) French
b895711 (master) Change greeting
f56e3da First hello
```
&lt;center&gt;&lt;img src=&#34;gitink/c6.svg&#34;&gt;&lt;/center&gt;

---

## Keep the changes: merge to master

```
$ git checkout master
Switched to branch &#39;master&#39;
```
&lt;center&gt;&lt;img src=&#34;gitink/c7.svg&#34;&gt;&lt;/center&gt;

---

## Keep the changes: merge to master

* Incorporate the changes from the `in-more-languages` branch

```
$ git merge in-more-languages 
Updating b895711..84bfae8
Fast-forward
 hello.py | 1 +
 1 file changed, 1 insertion(+)
```
&lt;center&gt;&lt;img src=&#34;gitink/c8.svg&#34;&gt;&lt;/center&gt;

---

## Keep the changes: merge to master

* If the old branch is not needed it may be deleted

```
$ git branch -d in-more-languages 
Deleted branch in-more-languages (was 84bfae8).

```
&lt;center&gt;&lt;img src=&#34;gitink/c9.svg&#34;&gt;&lt;/center&gt;

* Note: the branch concept brings to mind a certain line of development, like the
branch of a tree. However a git branch name essentially a label for a
particular commit. If one commit has two labels one of them can easily be
deleted without loosing any information.

---

## Remote repositories

* Necessary for collaborative projects
* Useful for single-user projects
* Web-services, github, gitlab, bitbucket
* A shared directory (NFS, AFS, Dropbox....)
* `git pull` from remote
* `git push` to remote

```
repository (.git)  &lt;-&gt;   remote
                pull,push

    ^
    |   commit

staging area (cache)

    ^
    |   add

work directory     &lt;- init, clone
```

---

## Working with KTH github

* See https://www.kth.se/student/kth-it-support/work-online/kth-github
* Go to https://gits-15.sys.kth.se and log in with your KTH account
* You need to upload ssh keys for this service

---

## Uploading a local repository

* Having logged in create a new empty repository in the browser
* Locally define an alias for the new remote repository: any name will do but
  *origin* is a common convention

```
$ git remote add origin git@gits-15.sys.kth.se:&lt;user&gt;/proj
```

```
$ git remote -v
origin git@gits-15.sys.kth.se:&lt;user&gt;/proj (fetch)
origin git@gits-15.sys.kth.se:&lt;user&gt;/proj (push)
```

* push the local to the remote, and let the local branch track the remote repository

```
$ git push --set-upstream origin master
...
To git@gits-15.sys.kth.se
 * [new branch]      master -&gt; master
Branch master set up to track remote branch master from origin.
$ git branch -vv
 * master 84bfae8 [origin/master] French
```

---

## Remote repository (origin)

&lt;img src=&#34;gitink/c9.svg&#34;&gt;

After the push operations the remote repository  has the same information as
the local

---

## Local repository

&lt;img src=&#34;gitink/c10.svg&#34;&gt;

In local repository also have knowledge about the status of the remote
repositry in terms of an extra branch name `origin/master`

---

## Continue work on another computer

* get a copy of the repository

```
    $ git clone git@gits-15.sys.kth.se:&lt;user&gt;/proj.git
    Cloning into &#39;proj&#39;...
    done.
    $ cd proj
```
* work on other computer and push back changes
    - edit -&gt; add -&gt; commit -&gt; push

---

## On another computer

```
$ git commit
```

&lt;img src=&#34;gitink/c11.svg&#34;&gt;

---

## On another computer

```
$ git push
```

&lt;img src=&#34;gitink/c12.svg&#34;&gt;

---

## Back on local computer

&lt;img src=&#34;gitink/c10.svg&#34;&gt;

---

## Back on local computer

* Retrieve changes that was made on another system

```
$ git fetch  # obtain new remote commits but do not change anything locally
```

&lt;img src=&#34;gitink/c13.svg&#34;&gt;

---

## Back on local computer

```
$ git pull # does a fetch and a merge to your local repository
```
&lt;img src=&#34;gitink/c14.svg&#34;&gt;

---

## Summary of work cycle

* Start a new project

```
    $ git init
```

* Get a copy of existing project

```
    $ git clone
```

* Locally: edit-add-commit

```
    $ [your-favorite-editor] filename
    $ git add...
    $ git commit...
```

* Sync with remote: pull-push

```
    $ git pull
    $ git push
```

---

## Github collaborative workflow

### Contributing to open source

A fork is your github copy the reference repository (here the class account) which you create in the web interface. We now have two remote repositories.


The name of a remote repository is an alias to a real address, and thinks may look different depending on order of commands, which repository you clone first and which you add later.

We have two situations

1. 
   * You clone your fork (`git clone &lt;fork url&gt;`), this will be given the alias origin by default
   * You may locally define the reference repository locally, `git remote add
     upstream &lt;reference url&gt;` (`upstream` is a conventional name)

2. 
   * You clone the reference repo (`git clone &lt;reference url&gt;`), which now will
   be the `origin`
   * You define locally your fork with e.g. `git remote add myfork &lt;fork url&gt;`
   which gives your github copy the alias `myfork`

Either method is equally valid, but the `origin` label means different things

---

## Github collaborative workflow (alt 1)

* Clone your fork
~~~
$ git clone &lt;fork url&gt;
~~~
* Define the reference repo as `upstream`
~~~
$ git remote add upstream &lt;reference url&gt;
~~~
* Retrieve the current information from the reference repo
```
$ git fetch upstream
```

&lt;img src=&#34;gitink/c15.svg&#34;&gt;

---

## Github collaborative workflow

* Create and checkout a &#39;fix&#39; branch for a particular change

```
$ git checkout -b fix
```

* Edit the file, add and commit locally

```
$ git add .
$ git commit -m &#34;This is my fix&#34;
```

&lt;img src=&#34;gitink/c16.svg&#34;&gt;

---

## Github collaborative workflow

* Push the fix branch to your copy repo

```
$ git push origin fix
```

&lt;img src=&#34;gitink/c17.svg&#34;&gt;

* Now you are ready to do a pull request in the Github web interface

---

## Github workflow scheme

&lt;!--
&lt;div class=&#34;row&#34;&gt;
&lt;div class=&#34;col-md-9&#34;&gt;
&lt;img class=&#34;img-responsive&#34; src=&#34;https://lh3.googleusercontent.com/e56nmW1H1vOmGoR0EVswqus0EcCFMPjefwrFDc6KS5Gm2Yc7P1VEy9WrxHu7iqkst6t-WFhhpXYqhwcY1cOAPUNLbimPm7Uvkl4ZanbNKed-wqFs1eae_hLvDB0jdko0hfNibGl7FA=w2400&#34;&gt;
&lt;/div&gt;
&lt;/div&gt;
--&gt;

&lt;img src=&#34;https://lh3.googleusercontent.com/e56nmW1H1vOmGoR0EVswqus0EcCFMPjefwrFDc6KS5Gm2Yc7P1VEy9WrxHu7iqkst6t-WFhhpXYqhwcY1cOAPUNLbimPm7Uvkl4ZanbNKed-wqFs1eae_hLvDB0jdko0hfNibGl7FA=w2400&#34; height=600&gt;

Drawing by Erik Fasterius

---

### Links

* http://git-scm.com/book
* http://swcarpentry.github.io/git-novice/
* http://www.linux.com/news/featured-blogs/185-jennifer-cloer/821541-10-years-of-git-an-interview-with-git-creator-linus-torvalds
* https://gun.io/blog/how-to-github-fork-branch-and-pull-request/
* https://www.linux.com/learn/fixing-mistakes-git
* http://christoph.ruegg.name/blog/git-howto-revert-a-commit-already-pushed-to-a-remote-reposit.html
* http://git-man-page-generator.lokaltog.net/

### Acknowledgement

* Figures produced with [gitink](https://github.com/bast/gitink) software by Radovan Bast

    </textarea>

    <script src="/git/refreeze/js/remark-latest.min.js" type="text/javascript"></script>
    <script type="text/javascript">
      var hljs = remark.highlighter.engine;
    </script>
    <script src="/git/refreeze/js/high.js" type="text/javascript"></script>
    <script type="text/javascript">
      var slideshow = remark.create({
          highlightStyle: 'sunburst',
          highlightLanguage: 'remark'
        }) ;
    </script>
  </body>
</html>